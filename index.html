<!DOCTYPE html>
<html>
  <head>
  <!-- styles put here, but you can include a CSS file and reference it instead! -->
    <style type="text/css">
      html, body { height: 100%; margin: 0; padding: 0; font-family: Ariel, Sans-Serif;}
      
 	  .floatingbox {
 	    border-radius: 5px;
        position: absolute;
        top: 45px;
        left: 10px;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        line-height: 30px; 
        padding-left: 10px;
      }
      
      h1 {
		font-size: 14px;
		font-color: Black;
		margin-bottom:0px;
        
		}
 		
      #map { height: 100%; 
      
      
      
      }
    </style>
  </head>
  <body>
  <!-- create a place to put the map -->
     <div class="floatingbox">
    <h1> My Super Cool Site </h1>
     <input id="showListings" type=button value="Show Listings">
     <input id="hideListings" type=button value="Hide Listings">
    </div>
    <div id="map"></div>
    <script type="text/javascript">
    
//create a map variable
var map;
//function to initialize the map within the map div
function initMap() {
  
var styles = [
    {
        "featureType": "water",
        "stylers": [
            {
                "color": "#19a0d8"
            }
        ]
    },
    {
        "featureType": "administrative",
        "elementType": "labels.text.stroke",
        "stylers": [
            {
                "color": "#ffffff"
            },
            {
                "weight": 6
            }
        ]
    },
    {
        "featureType": "administrative",
        "elementType": "labels.text.fill",
        "stylers": [
            {
                "color": "#e85113"
            }
        ]
    },
    {
        "featureType": "road.highway",
        "elementType": "geometry.stroke",
        "stylers": [
            {
                "color": "#efe9e4"
            },
            {
                "lightness": -40
            }
        ]
    },
    {
    "featureType": "transit.station",
    "stylers": [
      { "weight": 9 },
      { "hue": "#e85113" }
    ]
  },
    {
        "featureType": "road",
        "elementType": "labels.text.stroke",
        "stylers": [
            {
                "lightness": 100
            }
        ]
    },
    {
        "featureType": "road",
        "elementType": "labels.text.fill",
        "stylers": [
            {
                "lightness": -100
            }
        ]
    },
    {
        "featureType": "road.highway",
        "elementType": "labels.icon"
    },
    {
        "featureType": "landscape",
        "elementType": "labels",
        "stylers": [
            {
                "visibility": "off"
            }
        ]
    },
    {
        "featureType": "landscape",
        "stylers": [
            {
                "lightness": 20
            },
            {
                "color": "#efe9e4"
            }
        ]
    },
    {
        "featureType": "landscape.man_made",
        "stylers": [
            {
                "visibility": "off"
            }
        ]
    },
    {
        "featureType": "water",
        "elementType": "labels.text.stroke",
        "stylers": [
            {
                "lightness": 100
            }
        ]
    },
    {
        "featureType": "water",
        "elementType": "labels.text.fill",
        "stylers": [
            {
                "lightness": -100
            }
        ]
    },
    {
        "featureType": "poi",
        "elementType": "labels.text.fill",
        "stylers": [
            {
                "hue": "#11ff00"
            }
        ]
    },
    {
        "featureType": "poi",
        "elementType": "labels.text.stroke",
        "stylers": [
            {
                "lightness": 100
            }
        ]
    },
    {
        "featureType": "poi",
        "elementType": "labels.icon",
        "stylers": [
            {
                "hue": "#4cff00"
            },
            {
                "saturation": 58
            }
        ]
    },
    {
        "featureType": "poi",
        "elementType": "geometry",
        "stylers": [
            {
                "visibility": "on"
            },
            {
                "color": "#f0e4d3"
            }
        ]
    },
    {
        "featureType": "road.highway",
        "elementType": "geometry.fill",
        "stylers": [
            {
                "color": "#efe9e4"
            },
            {
                "lightness": -25
            }
        ]
    },
    {
        "featureType": "road.arterial",
        "elementType": "geometry.fill",
        "stylers": [
            {
                "color": "#efe9e4"
            },
            {
                "lightness": -10
            }
        ]
    },
    {
        "featureType": "poi",
        "elementType": "labels",
        "stylers": [
            {
                "visibility": "simplified"
            }
        ]
    }
]; 
//use a constructor to create a new map JS object
  map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 40.7413549, lng: -73.99802439999996},
    zoom: 13,
    styles: styles
  });
 
  
  //putting an event listener on the showListings button
  document.getElementById('showListings').addEventListener('click', function()   {
    showListings();
  });
  //putting an event listener on the hideListings button
  document.getElementById('hideListings').addEventListener('click', function() {
	  hideListings();
  });

  //new array of locations: in the array, these are the values:
  //0: title
  //1: LatLng
  //2: ID
 var locationArray = [ 
    ['Park Ave Penthouse', {lat:40.76344599999999, lng:-73.9686686}, 1],
    ['Chelsea Loft',  {lat:40.7452994, lng:-73.99848320000001}, 2],
    ['Union Square Open Floor Plan', {lat:40.7342965, lng:-73.9912195}, 3],
    ['East Village Hip Studio', {lat:40.7281777, lng:-73.984377}, 4],
    ['TriBeCa Artsy Bachelor Pad', {lat:40.7195264, lng:-74.00899340000001}, 5],
    ['Chinatown Homey Space', {lat:40.7180628, lng:-73.9961237}, 6],       
];
 
  //new blank array for all the markers
  var markers = [];
  
  //style the markers a bit
  var markerColor = "0091ff";
  var markerImage = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + markerColor,
        new google.maps.Size(21, 34),
        new google.maps.Point(0,0),
        new google.maps.Point(10, 34));
  
  //create a "favorite location" marker color
  var favMarkerColor = "FFFF24";
  var favMarkerImage = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + favMarkerColor,
        new google.maps.Size(21, 34),
        new google.maps.Point(0,0),
        new google.maps.Point(10, 34));
  
  
  //create counter variable
  var i;
  var position;
  var title;
  for (i = 0; i < locationArray.length; i++) {
    position = locationArray[i][1];
    title = locationArray[i][0];
    //create a marker per location, and put into markers array
    marker = new google.maps.Marker({
      position: position,
      title:title,
      animation: google.maps.Animation.DROP,
      icon: markerImage
    });
    //push the marker to our array of markers
    markers.push(marker);
    //create an onclick event to open an infowindow at each marker using this
    marker.addListener('click', function() {
      //taking this out of initialize since i'm making it a bigger function
      populateInfoWindow(this);
    });
    
    marker.addListener('mouseover', function() {
      this.setIcon(favMarkerImage);
      });
    
        marker.addListener('mouseout', function() {
      this.setIcon(markerImage);
      });
    
    //declaring a global variable for streetViewService
    var streetViewService;
 
  }
  //end of initialize function
  
 //adding the populate infowindow function
  function populateInfoWindow(marker){
    streetViewService = new google.maps.StreetViewService();
    var radius = 50;
    infowindow = new google.maps.InfoWindow();
    //now i'm calling streetview service, and telling it to get the closest streetview image within 20 meters of the markers position. I'm including a handler in case it doesn't find one.
    streetViewService.getPanoramaByLocation(marker.position, radius, handler);
    
 
    //in case the statis is OK, which means the pano was found, we will get compute the position of the streetview image, then calculate the heading, then get a panorama from that and set the options
    function handler(data, status) {
   	     if (status == google.maps.StreetViewStatus.OK) {
    			 var nearStreetViewLocation = data.location.latLng;
    			 var heading = google.maps.geometry.spherical.computeHeading(nearStreetViewLocation, marker.position);
    			 var panorama = map.getStreetView();
    			 infowindow.setContent('<div>'+marker.title+'</div>'+
 	    	    	    '<div id="pano" style="width:200px;height:200px;"></div></div>');
    			 var panoramaOptions = {
    				position: nearStreetViewLocation,
    				pov: {
    					heading: heading,
    					pitch:30
    				}
    			 };
    			 
    			 var panorama = new  google.maps.StreetViewPanorama(document.getElementById('pano'),panoramaOptions);
				 } 
          else {
   			     radius += 50;
    			 streetViewService.getPanoramaByLocation(latLng, radius, handler);
    			  }
		}; //END OF HANDLER FUNCTION
 
      infowindow.open(map, marker);
    
  }
      
  
 // Sets the map on all markers in the array.
  function showListings(){
    var latlngbounds = new google.maps.LatLngBounds();
    for (var i = 0; i < markers.length; i++) {
      markers[i].setMap(map);
      latlngbounds.extend(markers[i].position);
	}
	map.fitBounds(latlngbounds);
  };
  
  //sets the map on all the markers in the array to NULL
   function hideListings(){
    for (var i = 0; i < markers.length; i++) {
      markers[i].setMap(null);
	}
  };


}

      
    </script>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCmZ_1EX7cJmIaJu_ZIr46zPZ-HmQIGv7w&callback=initMap">
    </script>
  </body>
</html>
